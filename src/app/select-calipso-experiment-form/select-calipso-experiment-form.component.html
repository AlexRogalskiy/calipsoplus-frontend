<app-facility-nav></app-facility-nav>

<div class="row col">
  <app-experiment-nav></app-experiment-nav>

  <!-- experiments list -->
  <div class="col">

    <div class="row">
      <h1 class="col-sm-4"></h1>
      <h5 class="col-sm-4 text-center">
        <div *ngIf="max_num_machines_exceeded||max_num_cpu_exceeded||max_memory_exceeded||max_hdd_exceeded">
          <span class="badge badge-primary">Warning</span>
        </div>
        <div *ngIf="max_num_machines_exceeded">
          <span class="badge badge-warning">The number of machines per user has been exceeded.</span>
        </div>
        <div *ngIf="max_num_cpu_exceeded">
          <span class="badge badge-warning">The number of cpu per user has been exceeded.</span>
        </div>
        <div *ngIf="max_memory_exceeded">
          <span class="badge badge-warning">The memory per user has been exceeded.</span>
        </div>
        <div *ngIf="max_hdd_exceeded">
          <span class="badge badge-warning">The storage per user has been exceeded.</span>
        </div>
      </h5>
      <div class="col-sm-4"></div>
    </div>
    <div class="row">
      <h1 class="col-sm-4">Proposals</h1>
      <div class="col-sm-5"></div>
      <div class="col-sm-3">
        <div class="input-group align-vertical">
          <input type="text" (keyup.enter)="search_action(searchkey.value)" class="form-control" value="{{search_key}}" #searchkey
            placeholder="Search..." /> &nbsp;
          <span class="fa fa-search"></span>
        </div>
      </div>
    </div>

    <table class="table sortable">
      <thead>
        <tr class="d-flex">

          <th class="col-sm-2" (click)="sort_by_field('serial_number')">Proposal Id &nbsp;&nbsp;
            <i class="fas fa-sort"></i>
          </th>
          <th class="col-sm-3" (click)="sort_by_field('subject')">Title &nbsp;&nbsp;
            <i class="fas fa-sort"></i>
          </th>
          <th class="col-sm-3" (click)="sort_by_field('body')">Abstract &nbsp;&nbsp;
            <i class="fas fa-sort"></i>
          </th>
          <th class="col-sm-2" (click)="sort_by_field('beam_line')">Beamline &nbsp;&nbsp;
            <i class="fas fa-sort"></i>
          </th>
          <th class="col-sm-2 text-center"><i class="fas fa-laptop"></i>
            </th>
        </tr>
      </thead>
      <tbody>
        <tr class="d-flex" *ngFor="let experiment of experiments">
          <td class="col-sm-2">{{experiment.serial_number}}</td>
          <td class="col-sm-3">{{experiment.subject}}</td>
          <td class="col-sm-3">{{experiment.body | slice:0:106}} &nbsp;&nbsp;
             <a *ngIf="experiment.body.length>100" class="far fa-eye" title="{{experiment.body}}"></a>
          </td>
          <td class="col-sm-2">{{experiment.beam_line}}</td>
          <td class="col-sm-2 disabled text-center">
            <div [ngSwitch]="statusActiveExperiments[experiment.serial_number]">
              <div *ngSwitchCase="0" class="btn-group mr-3">
                <button [disabled]="max_hdd_exceeded || max_memory_exceeded || max_num_cpu_exceeded || max_num_machines_exceeded || safe_locked_button"
                  class="btn btn-outline-primary" (click)="run(experiment.serial_number)" type="button" class="btn btn-primary">Launch !</button>
                <div class="btn-group" ngbDropdown role="group" aria-label="Button group with nested dropdown">
                  <button [disabled]="max_hdd_exceeded || max_memory_exceeded || max_num_cpu_exceeded || max_num_machines_exceeded || safe_locked_button"
                    class="btn btn-primary dropdown-toggle-split" ngbDropdownToggle></button>
                  <div class="dropdown-menu" ngbDropdownMenu>
                    <button class="dropdown-item" (click)="run(experiment.serial_number)">Launch!</button>
                    <button class="dropdown-item">Link</button>
                    <button class="dropdown-item">Jupyter</button>
                  </div>
                </div>
              </div>

              <button *ngSwitchCase="1" class="btn btn-warning">
                <span class="fa fa-refresh fa-spin">&nbsp;</span>&nbsp;&nbsp;Wait&nbsp;&nbsp;</button>

              <button *ngSwitchCase="2" [disabled]="safe_locked_button" class="center-text btn btn-danger" (click)="stop_and_remove_container(experiment.serial_number)">Stop</button>
              <button *ngSwitchCase="2" [disabled]="safe_locked_button" class="btn btn-primary" (click)="go_in(experiment.serial_number)">ENTER</button>

              <li *ngSwitchDefault>Error</li>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <hr/>

    <div class="col-sm-12">
      <nav aria-label="experiments pagination">
        <ul class="pagination pagination-sm justify-content-center ">
          <li class="page-item {{compare_if_disabled(actual_page==1)}}">
            <button class="page-link " (click)="load_experiments(this.actual_page-1)">
              <span aria-hidden="true">&laquo;</span>

            </button>

          </li>


          <div *ngFor="let page of total_pages">
            <div *ngIf="this.showPage(page)">
              <li class="page-item {{compare_if_active(actual_page==page)}}">
                <button class="page-link" (click)="load_experiments(page)">
                  <span>{{page}}</span>
                </button>
              </li>
            </div>
            <div *ngIf="!this.showPage(page)">
              <li class="page-item disabled">
                <button class="page-link">
                  <span>...</span>
                </button>
              </li>
            </div>
          </div>


          <li class="page-item {{compare_if_disabled(actual_page>=pagination.count/pagination.page_size)}}">
            <button class="page-link" (click)="load_experiments(this.actual_page+1)">
              <span aria-hidden="true">&raquo;</span>
            </button>
          </li>
        </ul>
      </nav>

    </div>
    <hr/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
  </div>
</div>
